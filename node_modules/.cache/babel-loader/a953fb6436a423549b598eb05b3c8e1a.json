{"ast":null,"code":"import _objectSpread from\"C:\\\\Users\\\\Kamikaze\\\\Desktop\\\\Mainnet\\\\metaplex\\\\js\\\\packages\\\\candy-machine-ui\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\objectSpread2.js\";import _asyncToGenerator from\"C:\\\\Users\\\\Kamikaze\\\\Desktop\\\\Mainnet\\\\metaplex\\\\js\\\\packages\\\\candy-machine-ui\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\asyncToGenerator.js\";import _slicedToArray from\"C:\\\\Users\\\\Kamikaze\\\\Desktop\\\\Mainnet\\\\metaplex\\\\js\\\\packages\\\\candy-machine-ui\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\slicedToArray.js\";import _taggedTemplateLiteral from\"C:\\\\Users\\\\Kamikaze\\\\Desktop\\\\Mainnet\\\\metaplex\\\\js\\\\packages\\\\candy-machine-ui\\\\node_modules\\\\@babel\\\\runtime\\\\helpers\\\\esm\\\\taggedTemplateLiteral.js\";var _templateObject,_templateObject2;import _regeneratorRuntime from\"C:\\\\Users\\\\Kamikaze\\\\Desktop\\\\Mainnet\\\\metaplex\\\\js\\\\packages\\\\candy-machine-ui\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import{useCallback,useEffect,useMemo,useState}from'react';import*as anchor from'@project-serum/anchor';import styled from'styled-components';import{Container,Snackbar}from'@material-ui/core';import Paper from'@material-ui/core/Paper';import Alert from'@material-ui/lab/Alert';import Grid from'@material-ui/core/Grid';import Typography from'@material-ui/core/Typography';import{Connection,PublicKey}from'@solana/web3.js';import{useWallet}from'@solana/wallet-adapter-react';import{WalletDialogButton}from'@solana/wallet-adapter-material-ui';import{awaitTransactionSignatureConfirmation,CANDY_MACHINE_PROGRAM,createAccountsForMint,getCandyMachineState,getCollectionPDA,mintOneToken}from'./candy-machine';import{formatNumber,getAtaForMint,toDate}from'./utils';import{MintCountdown}from'./MintCountdown';import{MintButton}from'./MintButton';import{GatewayProvider}from'@civic/solana-gateway-react';import{sendTransaction}from'./connection';import{WalletAdapterNetwork}from'@solana/wallet-adapter-base';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var ConnectButton=styled(WalletDialogButton)(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n  width: 100%;\\n  height: 60px;\\n  margin-top: 10px;\\n  margin-bottom: 5px;\\n  background: linear-gradient(180deg, #604ae5 0%, #813eee 100%);\\n  color: white;\\n  font-size: 16px;\\n  font-weight: bold;\\n\"])));var MintContainer=styled.div(_templateObject2||(_templateObject2=_taggedTemplateLiteral([\"\"])));// add your owns styles here\nvar Home=function Home(props){var _candyMachine$state,_candyMachine$state2,_candyMachine$state2$;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isUserMinting=_useState2[0],setIsUserMinting=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),candyMachine=_useState4[0],setCandyMachine=_useState4[1];var _useState5=useState({open:false,message:'',severity:undefined}),_useState6=_slicedToArray(_useState5,2),alertState=_useState6[0],setAlertState=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),isActive=_useState8[0],setIsActive=_useState8[1];var _useState9=useState(),_useState10=_slicedToArray(_useState9,2),endDate=_useState10[0],setEndDate=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),itemsRemaining=_useState12[0],setItemsRemaining=_useState12[1];var _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),isWhitelistUser=_useState14[0],setIsWhitelistUser=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),isPresale=_useState16[0],setIsPresale=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),isValidBalance=_useState18[0],setIsValidBalance=_useState18[1];var _useState19=useState(),_useState20=_slicedToArray(_useState19,2),discountPrice=_useState20[0],setDiscountPrice=_useState20[1];var _useState21=useState(true),_useState22=_slicedToArray(_useState21,2),needTxnSplit=_useState22[0],setNeedTxnSplit=_useState22[1];var _useState23=useState(),_useState24=_slicedToArray(_useState23,2),setupTxn=_useState24[0],setSetupTxn=_useState24[1];var rpcUrl=props.rpcHost;var wallet=useWallet();var anchorWallet=useMemo(function(){if(!wallet||!wallet.publicKey||!wallet.signAllTransactions||!wallet.signTransaction){return;}return{publicKey:wallet.publicKey,signAllTransactions:wallet.signAllTransactions,signTransaction:wallet.signTransaction};},[wallet]);var refreshCandyMachineState=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var commitment,connection,_cndy$state$goLiveDat,_cndy$state$endSettin,_cndy$state$endSettin2,_cndy$state$whitelist,_cndy$state$whitelist2,_cndy$state$gatekeepe,cndy,active,presale,isWLUser,userPrice,mint,token,balance,_mint,_token,_balance,valid,_balance2,_valid,limit,_yield$getCollectionP,_yield$getCollectionP2,collectionPDA,collectionPDAAccount,txnEstimate,_args=arguments;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:commitment=_args.length>0&&_args[0]!==undefined?_args[0]:'confirmed';if(anchorWallet){_context.next=3;break;}return _context.abrupt(\"return\");case 3:connection=new Connection(props.rpcHost,commitment);if(!props.candyMachineId){_context.next=90;break;}_context.prev=5;_context.next=8;return getCandyMachineState(anchorWallet,props.candyMachineId,connection);case 8:cndy=_context.sent;active=(cndy===null||cndy===void 0?void 0:(_cndy$state$goLiveDat=cndy.state.goLiveDate)===null||_cndy$state$goLiveDat===void 0?void 0:_cndy$state$goLiveDat.toNumber())<new Date().getTime()/1000;presale=false;// duplication of state to make sure we have the right values!\nisWLUser=false;userPrice=cndy.state.price;// whitelist mint?\nif(!(cndy!==null&&cndy!==void 0&&cndy.state.whitelistMintSettings)){_context.next=35;break;}// is it a presale mint?\nif(cndy.state.whitelistMintSettings.presale&&(!cndy.state.goLiveDate||cndy.state.goLiveDate.toNumber()>new Date().getTime()/1000)){presale=true;}// is there a discount?\nif(cndy.state.whitelistMintSettings.discountPrice){setDiscountPrice(cndy.state.whitelistMintSettings.discountPrice);userPrice=cndy.state.whitelistMintSettings.discountPrice;}else{setDiscountPrice(undefined);// when presale=false and discountPrice=null, mint is restricted\n// to whitelist users only\nif(!cndy.state.whitelistMintSettings.presale){cndy.state.isWhitelistOnly=true;}}// retrieves the whitelist token\nmint=new anchor.web3.PublicKey(cndy.state.whitelistMintSettings.mint);_context.next=19;return getAtaForMint(mint,anchorWallet.publicKey);case 19:token=_context.sent[0];_context.prev=20;_context.next=23;return connection.getTokenAccountBalance(token);case 23:balance=_context.sent;isWLUser=parseInt(balance.value.amount)>0;// only whitelist the user if the balance > 0\nsetIsWhitelistUser(isWLUser);if(cndy.state.isWhitelistOnly){active=isWLUser&&(presale||active);}_context.next=35;break;case 29:_context.prev=29;_context.t0=_context[\"catch\"](20);setIsWhitelistUser(false);// no whitelist user, no mint\nif(cndy.state.isWhitelistOnly){active=false;}console.log('There was a problem fetching whitelist token balance');console.log(_context.t0);case 35:userPrice=isWLUser?userPrice:cndy.state.price;if(!(cndy!==null&&cndy!==void 0&&cndy.state.tokenMint)){_context.next=58;break;}// retrieves the SPL token\n_mint=new anchor.web3.PublicKey(cndy.state.tokenMint);_context.next=40;return getAtaForMint(_mint,anchorWallet.publicKey);case 40:_token=_context.sent[0];_context.prev=41;_context.next=44;return connection.getTokenAccountBalance(_token);case 44:_balance=_context.sent;valid=new anchor.BN(_balance.value.amount).gte(userPrice);// only allow user to mint if token balance >  the user if the balance > 0\nsetIsValidBalance(valid);active=active&&valid;_context.next=56;break;case 50:_context.prev=50;_context.t1=_context[\"catch\"](41);setIsValidBalance(false);active=false;// no whitelist user, no mint\nconsole.log('There was a problem fetching SPL token balance');console.log(_context.t1);case 56:_context.next=66;break;case 58:_context.t2=anchor.BN;_context.next=61;return connection.getBalance(anchorWallet.publicKey);case 61:_context.t3=_context.sent;_balance2=new _context.t2(_context.t3);_valid=_balance2.gte(userPrice);setIsValidBalance(_valid);active=active&&_valid;case 66:// datetime to stop the mint?\nif(cndy!==null&&cndy!==void 0&&(_cndy$state$endSettin=cndy.state.endSettings)!==null&&_cndy$state$endSettin!==void 0&&_cndy$state$endSettin.endSettingType.date){setEndDate(toDate(cndy.state.endSettings.number));if(cndy.state.endSettings.number.toNumber()<new Date().getTime()/1000){active=false;}}// amount to stop the mint?\nif(cndy!==null&&cndy!==void 0&&(_cndy$state$endSettin2=cndy.state.endSettings)!==null&&_cndy$state$endSettin2!==void 0&&_cndy$state$endSettin2.endSettingType.amount){limit=Math.min(cndy.state.endSettings.number.toNumber(),cndy.state.itemsAvailable);if(cndy.state.itemsRedeemed<limit){setItemsRemaining(limit-cndy.state.itemsRedeemed);}else{setItemsRemaining(0);cndy.state.isSoldOut=true;}}else{setItemsRemaining(cndy.state.itemsRemaining);}if(cndy.state.isSoldOut){active=false;}_context.next=71;return getCollectionPDA(props.candyMachineId);case 71:_yield$getCollectionP=_context.sent;_yield$getCollectionP2=_slicedToArray(_yield$getCollectionP,1);collectionPDA=_yield$getCollectionP2[0];_context.next=76;return connection.getAccountInfo(collectionPDA);case 76:collectionPDAAccount=_context.sent;setIsActive(cndy.state.isActive=active);setIsPresale(cndy.state.isPresale=presale);setCandyMachine(cndy);txnEstimate=892+(!!collectionPDAAccount&&cndy.state.retainAuthority?182:0)+(cndy.state.tokenMint?177:0)+(cndy.state.whitelistMintSettings?33:0)+((_cndy$state$whitelist=cndy.state.whitelistMintSettings)!==null&&_cndy$state$whitelist!==void 0&&(_cndy$state$whitelist2=_cndy$state$whitelist.mode)!==null&&_cndy$state$whitelist2!==void 0&&_cndy$state$whitelist2.burnEveryTime?145:0)+(cndy.state.gatekeeper?33:0)+((_cndy$state$gatekeepe=cndy.state.gatekeeper)!==null&&_cndy$state$gatekeepe!==void 0&&_cndy$state$gatekeepe.expireOnUse?66:0);setNeedTxnSplit(txnEstimate>1230);_context.next=88;break;case 84:_context.prev=84;_context.t4=_context[\"catch\"](5);if(_context.t4 instanceof Error){if(_context.t4.message===\"Account does not exist \".concat(props.candyMachineId)){setAlertState({open:true,message:\"Couldn't fetch candy machine state from candy machine with address: \".concat(props.candyMachineId,\", using rpc: \").concat(props.rpcHost,\"! You probably typed the REACT_APP_CANDY_MACHINE_ID value in wrong in your .env file, or you are using the wrong RPC!\"),severity:'error',hideDuration:null});}else if(_context.t4.message.startsWith('failed to get info about account')){setAlertState({open:true,message:\"Couldn't fetch candy machine state with rpc: \".concat(props.rpcHost,\"! This probably means you have an issue with the REACT_APP_SOLANA_RPC_HOST value in your .env file, or you are not using a custom RPC!\"),severity:'error',hideDuration:null});}}else{setAlertState({open:true,message:\"\".concat(_context.t4),severity:'error',hideDuration:null});}console.log(_context.t4);case 88:_context.next=91;break;case 90:setAlertState({open:true,message:\"Your REACT_APP_CANDY_MACHINE_ID value in the .env file doesn't look right! Make sure you enter it in as plain base-58 address!\",severity:'error',hideDuration:null});case 91:case\"end\":return _context.stop();}}},_callee,null,[[5,84],[20,29],[41,50]]);})),[anchorWallet,props.candyMachineId,props.rpcHost]);var onMint=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var beforeTransactions,afterTransactions,_document$getElementB,_setupMint,setupMint,_status,mintResult,status,metadataStatus,remaining,message,_args2=arguments;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:beforeTransactions=_args2.length>0&&_args2[0]!==undefined?_args2[0]:[];afterTransactions=_args2.length>1&&_args2[1]!==undefined?_args2[1]:[];_context2.prev=2;setIsUserMinting(true);(_document$getElementB=document.getElementById('#identity'))===null||_document$getElementB===void 0?void 0:_document$getElementB.click();if(!(wallet.connected&&candyMachine!==null&&candyMachine!==void 0&&candyMachine.program&&wallet.publicKey)){_context2.next=41;break;}if(!(needTxnSplit&&setupTxn===undefined)){_context2.next=26;break;}setAlertState({open:true,message:'Please sign account setup transaction',severity:'info'});_context2.next=10;return createAccountsForMint(candyMachine,wallet.publicKey);case 10:setupMint=_context2.sent;_status={err:true};if(!setupMint.transaction){_context2.next=16;break;}_context2.next=15;return awaitTransactionSignatureConfirmation(setupMint.transaction,props.txTimeout,props.connection,true);case 15:_status=_context2.sent;case 16:if(!(_status&&!_status.err)){_context2.next=21;break;}setSetupTxn(setupMint);setAlertState({open:true,message:'Setup transaction succeeded! Please sign minting transaction',severity:'info'});_context2.next=24;break;case 21:setAlertState({open:true,message:'Mint failed! Please try again!',severity:'error'});setIsUserMinting(false);return _context2.abrupt(\"return\");case 24:_context2.next=27;break;case 26:setAlertState({open:true,message:'Please sign minting transaction',severity:'info'});case 27:_context2.next=29;return mintOneToken(candyMachine,wallet.publicKey,beforeTransactions,afterTransactions,(_setupMint=setupMint)!==null&&_setupMint!==void 0?_setupMint:setupTxn);case 29:mintResult=_context2.sent;status={err:true};metadataStatus=null;if(!mintResult){_context2.next=40;break;}_context2.next=35;return awaitTransactionSignatureConfirmation(mintResult.mintTxId,props.txTimeout,props.connection,true);case 35:status=_context2.sent;_context2.next=38;return candyMachine.program.provider.connection.getAccountInfo(mintResult.metadataKey,'processed');case 38:metadataStatus=_context2.sent;console.log('Metadata status: ',!!metadataStatus);case 40:if(status&&!status.err&&metadataStatus){// manual update since the refresh might not detect\n// the change immediately\nremaining=itemsRemaining-1;setItemsRemaining(remaining);setIsActive(candyMachine.state.isActive=remaining>0);candyMachine.state.isSoldOut=remaining===0;setSetupTxn(undefined);setAlertState({open:true,message:'Congratulations! Mint succeeded!',severity:'success',hideDuration:7000});refreshCandyMachineState('processed');}else if(status&&!status.err){setAlertState({open:true,message:'Mint likely failed! Anti-bot SOL 0.01 fee potentially charged! Check the explorer to confirm the mint failed and if so, make sure you are eligible to mint before trying again.',severity:'error',hideDuration:8000});refreshCandyMachineState();}else{setAlertState({open:true,message:'Mint failed! Please try again!',severity:'error'});refreshCandyMachineState();}case 41:_context2.next=49;break;case 43:_context2.prev=43;_context2.t0=_context2[\"catch\"](2);message=_context2.t0.msg||'Minting failed! Please try again!';if(!_context2.t0.msg){if(!_context2.t0.message){message='Transaction timeout! Please try again.';}else if(_context2.t0.message.indexOf('0x137')){console.log(_context2.t0);message=\"SOLD OUT!\";}else if(_context2.t0.message.indexOf('0x135')){message=\"Insufficient funds to mint. Please fund your wallet.\";}}else{if(_context2.t0.code===311){console.log(_context2.t0);message=\"SOLD OUT!\";window.location.reload();}else if(_context2.t0.code===312){message=\"Minting period hasn't started yet.\";}}setAlertState({open:true,message:message,severity:'error'});// updates the candy machine state to reflect the latest\n// information on chain\nrefreshCandyMachineState();case 49:_context2.prev=49;setIsUserMinting(false);return _context2.finish(49);case 52:case\"end\":return _context2.stop();}}},_callee2,null,[[2,43,49,52]]);}));return function onMint(){return _ref2.apply(this,arguments);};}();var toggleMintButton=function toggleMintButton(){var active=!isActive||isPresale;if(active){if(candyMachine.state.isWhitelistOnly&&!isWhitelistUser){active=false;}if(endDate&&Date.now()>=endDate.getTime()){active=false;}}if(isPresale&&candyMachine.state.goLiveDate&&candyMachine.state.goLiveDate.toNumber()<=new Date().getTime()/1000){setIsPresale(candyMachine.state.isPresale=false);}setIsActive(candyMachine.state.isActive=active);};useEffect(function(){refreshCandyMachineState();},[anchorWallet,props.candyMachineId,props.connection,refreshCandyMachineState]);useEffect(function(){(function loop(){setTimeout(function(){refreshCandyMachineState();loop();},20000);})();},[refreshCandyMachineState]);return/*#__PURE__*/_jsxs(Container,{style:{marginTop:100},children:[/*#__PURE__*/_jsx(Container,{maxWidth:\"xs\",style:{position:'relative'},children:/*#__PURE__*/_jsxs(Paper,{style:{padding:24,paddingBottom:10,backgroundColor:'#151A1F',borderRadius:6},children:[!wallet.connected?/*#__PURE__*/_jsx(ConnectButton,{children:\"Connect Wallet\"}):/*#__PURE__*/_jsxs(_Fragment,{children:[candyMachine&&/*#__PURE__*/_jsxs(Grid,{container:true,direction:\"row\",justifyContent:\"center\",wrap:\"nowrap\",children:[/*#__PURE__*/_jsxs(Grid,{item:true,xs:3,children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:\"Remaining\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"textPrimary\",style:{fontWeight:'bold'},children:\"\".concat(itemsRemaining)})]}),/*#__PURE__*/_jsxs(Grid,{item:true,xs:4,children:[/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"textSecondary\",children:isWhitelistUser&&discountPrice?'Discount Price':'Price'}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"textPrimary\",style:{fontWeight:'bold'},children:isWhitelistUser&&discountPrice?\"\\u25CE \".concat(formatNumber.asNumber(discountPrice)):\"\\u25CE \".concat(formatNumber.asNumber(candyMachine.state.price))})]}),/*#__PURE__*/_jsx(Grid,{item:true,xs:5,children:isActive&&endDate&&Date.now()<endDate.getTime()?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(MintCountdown,{date:getCountdownDate(candyMachine),style:{justifyContent:'flex-end'},status:\"COMPLETED\",onComplete:toggleMintButton},\"endSettings\"),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",align:\"center\",display:\"block\",style:{fontWeight:'bold'},children:\"TO END OF MINT\"})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(MintCountdown,{date:getCountdownDate(candyMachine),style:{justifyContent:'flex-end'},status:candyMachine!==null&&candyMachine!==void 0&&(_candyMachine$state=candyMachine.state)!==null&&_candyMachine$state!==void 0&&_candyMachine$state.isSoldOut||endDate&&Date.now()>endDate.getTime()?'COMPLETED':isPresale?'PRESALE':'LIVE',onComplete:toggleMintButton},\"goLive\"),isPresale&&candyMachine.state.goLiveDate&&candyMachine.state.goLiveDate.toNumber()>new Date().getTime()/1000&&/*#__PURE__*/_jsx(Typography,{variant:\"caption\",align:\"center\",display:\"block\",style:{fontWeight:'bold'},children:\"UNTIL PUBLIC MINT\"})]})})]}),/*#__PURE__*/_jsx(MintContainer,{children:candyMachine!==null&&candyMachine!==void 0&&candyMachine.state.isActive&&candyMachine!==null&&candyMachine!==void 0&&candyMachine.state.gatekeeper&&wallet.publicKey&&wallet.signTransaction?/*#__PURE__*/_jsx(GatewayProvider,{wallet:{publicKey:wallet.publicKey||new PublicKey(CANDY_MACHINE_PROGRAM),//@ts-ignore\nsignTransaction:wallet.signTransaction},gatekeeperNetwork:candyMachine===null||candyMachine===void 0?void 0:(_candyMachine$state2=candyMachine.state)===null||_candyMachine$state2===void 0?void 0:(_candyMachine$state2$=_candyMachine$state2.gatekeeper)===null||_candyMachine$state2$===void 0?void 0:_candyMachine$state2$.gatekeeperNetwork,clusterUrl:props.network===WalletAdapterNetwork.Devnet?'https://api.devnet.solana.com':rpcUrl,handleTransaction:/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(transaction){var userMustSign;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setIsUserMinting(true);userMustSign=transaction.signatures.find(function(sig){return sig.publicKey.equals(wallet.publicKey);});if(!userMustSign){_context3.next=17;break;}setAlertState({open:true,message:'Please sign one-time Civic Pass issuance',severity:'info'});_context3.prev=4;_context3.next=7;return wallet.signTransaction(transaction);case 7:transaction=_context3.sent;_context3.next=15;break;case 10:_context3.prev=10;_context3.t0=_context3[\"catch\"](4);setAlertState({open:true,message:'User cancelled signing',severity:'error'});// setTimeout(() => window.location.reload(), 2000);\nsetIsUserMinting(false);throw _context3.t0;case 15:_context3.next=18;break;case 17:setAlertState({open:true,message:'Refreshing Civic Pass',severity:'info'});case 18:_context3.prev=18;_context3.next=21;return sendTransaction(props.connection,wallet,transaction,[],true,'confirmed');case 21:setAlertState({open:true,message:'Please sign minting',severity:'info'});_context3.next=30;break;case 24:_context3.prev=24;_context3.t1=_context3[\"catch\"](18);setAlertState({open:true,message:'Solana dropped the transaction, please try again',severity:'warning'});console.error(_context3.t1);// setTimeout(() => window.location.reload(), 2000);\nsetIsUserMinting(false);throw _context3.t1;case 30:_context3.next=32;return onMint();case 32:case\"end\":return _context3.stop();}}},_callee3,null,[[4,10],[18,24]]);}));return function(_x){return _ref3.apply(this,arguments);};}(),broadcastTransaction:false,options:{autoShowModal:false},children:/*#__PURE__*/_jsx(MintButton,{candyMachine:candyMachine,isMinting:isUserMinting,setIsMinting:function setIsMinting(val){return setIsUserMinting(val);},onMint:onMint,isActive:isActive||isPresale&&isWhitelistUser&&isValidBalance})}):/*#__PURE__*/_jsx(MintButton,{candyMachine:candyMachine,isMinting:isUserMinting,setIsMinting:function setIsMinting(val){return setIsUserMinting(val);},onMint:onMint,isActive:isActive||isPresale&&isWhitelistUser&&isValidBalance})})]}),/*#__PURE__*/_jsx(Typography,{variant:\"caption\",align:\"center\",display:\"block\",style:{marginTop:7,color:'grey'},children:\"Powered by METAPLEX\"})]})}),/*#__PURE__*/_jsx(Snackbar,{open:alertState.open,autoHideDuration:alertState.hideDuration===undefined?6000:alertState.hideDuration,onClose:function onClose(){return setAlertState(_objectSpread(_objectSpread({},alertState),{},{open:false}));},children:/*#__PURE__*/_jsx(Alert,{onClose:function onClose(){return setAlertState(_objectSpread(_objectSpread({},alertState),{},{open:false}));},severity:alertState.severity,children:alertState.message})})]});};var getCountdownDate=function getCountdownDate(candyMachine){var _candyMachine$state$e;if(candyMachine.state.isActive&&(_candyMachine$state$e=candyMachine.state.endSettings)!==null&&_candyMachine$state$e!==void 0&&_candyMachine$state$e.endSettingType.date){return toDate(candyMachine.state.endSettings.number);}return toDate(candyMachine.state.goLiveDate?candyMachine.state.goLiveDate:candyMachine.state.isPresale?new anchor.BN(new Date().getTime()/1000):undefined);};export default Home;","map":{"version":3,"sources":["C:/Users/Kamikaze/Desktop/Mainnet/metaplex/js/packages/candy-machine-ui/src/Home.tsx"],"names":["useCallback","useEffect","useMemo","useState","anchor","styled","Container","Snackbar","Paper","Alert","Grid","Typography","Connection","PublicKey","useWallet","WalletDialogButton","awaitTransactionSignatureConfirmation","CANDY_MACHINE_PROGRAM","createAccountsForMint","getCandyMachineState","getCollectionPDA","mintOneToken","formatNumber","getAtaForMint","toDate","MintCountdown","MintButton","GatewayProvider","sendTransaction","WalletAdapterNetwork","ConnectButton","MintContainer","div","Home","props","isUserMinting","setIsUserMinting","candyMachine","setCandyMachine","open","message","severity","undefined","alertState","setAlertState","isActive","setIsActive","endDate","setEndDate","itemsRemaining","setItemsRemaining","isWhitelistUser","setIsWhitelistUser","isPresale","setIsPresale","isValidBalance","setIsValidBalance","discountPrice","setDiscountPrice","needTxnSplit","setNeedTxnSplit","setupTxn","setSetupTxn","rpcUrl","rpcHost","wallet","anchorWallet","publicKey","signAllTransactions","signTransaction","refreshCandyMachineState","commitment","connection","candyMachineId","cndy","active","state","goLiveDate","toNumber","Date","getTime","presale","isWLUser","userPrice","price","whitelistMintSettings","isWhitelistOnly","mint","web3","token","getTokenAccountBalance","balance","parseInt","value","amount","console","log","tokenMint","valid","BN","gte","getBalance","endSettings","endSettingType","date","number","limit","Math","min","itemsAvailable","itemsRedeemed","isSoldOut","collectionPDA","getAccountInfo","collectionPDAAccount","txnEstimate","retainAuthority","mode","burnEveryTime","gatekeeper","expireOnUse","Error","hideDuration","startsWith","onMint","beforeTransactions","afterTransactions","document","getElementById","click","connected","program","setupMint","status","err","transaction","txTimeout","mintResult","metadataStatus","mintTxId","provider","metadataKey","remaining","msg","indexOf","code","window","location","reload","toggleMintButton","now","loop","setTimeout","marginTop","position","padding","paddingBottom","backgroundColor","borderRadius","fontWeight","asNumber","getCountdownDate","justifyContent","gatekeeperNetwork","network","Devnet","userMustSign","signatures","find","sig","equals","error","autoShowModal","val","color"],"mappings":"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","sourcesContent":["import { useCallback, useEffect, useMemo, useState } from 'react';\r\nimport * as anchor from '@project-serum/anchor';\r\n\r\nimport styled from 'styled-components';\r\nimport { Container, Snackbar } from '@material-ui/core';\r\nimport Paper from '@material-ui/core/Paper';\r\nimport Alert from '@material-ui/lab/Alert';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport {\r\n  Commitment,\r\n  Connection,\r\n  PublicKey,\r\n  Transaction,\r\n} from '@solana/web3.js';\r\nimport { useWallet } from '@solana/wallet-adapter-react';\r\nimport { WalletDialogButton } from '@solana/wallet-adapter-material-ui';\r\nimport {\r\n  awaitTransactionSignatureConfirmation,\r\n  CANDY_MACHINE_PROGRAM,\r\n  CandyMachineAccount,\r\n  createAccountsForMint,\r\n  getCandyMachineState,\r\n  getCollectionPDA,\r\n  mintOneToken,\r\n  SetupState,\r\n} from './candy-machine';\r\nimport { AlertState, formatNumber, getAtaForMint, toDate } from './utils';\r\nimport { MintCountdown } from './MintCountdown';\r\nimport { MintButton } from './MintButton';\r\nimport { GatewayProvider } from '@civic/solana-gateway-react';\r\nimport { sendTransaction } from './connection';\r\nimport { WalletAdapterNetwork } from '@solana/wallet-adapter-base';\r\n\r\nconst ConnectButton = styled(WalletDialogButton)`\r\n  width: 100%;\r\n  height: 60px;\r\n  margin-top: 10px;\r\n  margin-bottom: 5px;\r\n  background: linear-gradient(180deg, #604ae5 0%, #813eee 100%);\r\n  color: white;\r\n  font-size: 16px;\r\n  font-weight: bold;\r\n`;\r\n\r\nconst MintContainer = styled.div``; // add your owns styles here\r\n\r\nexport interface HomeProps {\r\n  candyMachineId?: anchor.web3.PublicKey;\r\n  connection: anchor.web3.Connection;\r\n  txTimeout: number;\r\n  rpcHost: string;\r\n  network: WalletAdapterNetwork;\r\n}\r\n\r\nconst Home = (props: HomeProps) => {\r\n  const [isUserMinting, setIsUserMinting] = useState(false);\r\n  const [candyMachine, setCandyMachine] = useState<CandyMachineAccount>();\r\n  const [alertState, setAlertState] = useState<AlertState>({\r\n    open: false,\r\n    message: '',\r\n    severity: undefined,\r\n  });\r\n  const [isActive, setIsActive] = useState(false);\r\n  const [endDate, setEndDate] = useState<Date>();\r\n  const [itemsRemaining, setItemsRemaining] = useState<number>();\r\n  const [isWhitelistUser, setIsWhitelistUser] = useState(false);\r\n  const [isPresale, setIsPresale] = useState(false);\r\n  const [isValidBalance, setIsValidBalance] = useState(false);\r\n  const [discountPrice, setDiscountPrice] = useState<anchor.BN>();\r\n  const [needTxnSplit, setNeedTxnSplit] = useState(true);\r\n  const [setupTxn, setSetupTxn] = useState<SetupState>();\r\n\r\n  const rpcUrl = props.rpcHost;\r\n  const wallet = useWallet();\r\n\r\n  const anchorWallet = useMemo(() => {\r\n    if (\r\n      !wallet ||\r\n      !wallet.publicKey ||\r\n      !wallet.signAllTransactions ||\r\n      !wallet.signTransaction\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    return {\r\n      publicKey: wallet.publicKey,\r\n      signAllTransactions: wallet.signAllTransactions,\r\n      signTransaction: wallet.signTransaction,\r\n    } as anchor.Wallet;\r\n  }, [wallet]);\r\n\r\n  const refreshCandyMachineState = useCallback(\r\n    async (commitment: Commitment = 'confirmed') => {\r\n      if (!anchorWallet) {\r\n        return;\r\n      }\r\n\r\n      const connection = new Connection(props.rpcHost, commitment);\r\n\r\n      if (props.candyMachineId) {\r\n        try {\r\n          const cndy = await getCandyMachineState(\r\n            anchorWallet,\r\n            props.candyMachineId,\r\n            connection,\r\n          );\r\n          let active =\r\n            cndy?.state.goLiveDate?.toNumber() < new Date().getTime() / 1000;\r\n          let presale = false;\r\n\r\n          // duplication of state to make sure we have the right values!\r\n          let isWLUser = false;\r\n          let userPrice = cndy.state.price;\r\n\r\n          // whitelist mint?\r\n          if (cndy?.state.whitelistMintSettings) {\r\n            // is it a presale mint?\r\n            if (\r\n              cndy.state.whitelistMintSettings.presale &&\r\n              (!cndy.state.goLiveDate ||\r\n                cndy.state.goLiveDate.toNumber() > new Date().getTime() / 1000)\r\n            ) {\r\n              presale = true;\r\n            }\r\n            // is there a discount?\r\n            if (cndy.state.whitelistMintSettings.discountPrice) {\r\n              setDiscountPrice(cndy.state.whitelistMintSettings.discountPrice);\r\n              userPrice = cndy.state.whitelistMintSettings.discountPrice;\r\n            } else {\r\n              setDiscountPrice(undefined);\r\n              // when presale=false and discountPrice=null, mint is restricted\r\n              // to whitelist users only\r\n              if (!cndy.state.whitelistMintSettings.presale) {\r\n                cndy.state.isWhitelistOnly = true;\r\n              }\r\n            }\r\n            // retrieves the whitelist token\r\n            const mint = new anchor.web3.PublicKey(\r\n              cndy.state.whitelistMintSettings.mint,\r\n            );\r\n            const token = (\r\n              await getAtaForMint(mint, anchorWallet.publicKey)\r\n            )[0];\r\n\r\n            try {\r\n              const balance = await connection.getTokenAccountBalance(token);\r\n              isWLUser = parseInt(balance.value.amount) > 0;\r\n              // only whitelist the user if the balance > 0\r\n              setIsWhitelistUser(isWLUser);\r\n\r\n              if (cndy.state.isWhitelistOnly) {\r\n                active = isWLUser && (presale || active);\r\n              }\r\n            } catch (e) {\r\n              setIsWhitelistUser(false);\r\n              // no whitelist user, no mint\r\n              if (cndy.state.isWhitelistOnly) {\r\n                active = false;\r\n              }\r\n              console.log(\r\n                'There was a problem fetching whitelist token balance',\r\n              );\r\n              console.log(e);\r\n            }\r\n          }\r\n          userPrice = isWLUser ? userPrice : cndy.state.price;\r\n\r\n          if (cndy?.state.tokenMint) {\r\n            // retrieves the SPL token\r\n            const mint = new anchor.web3.PublicKey(cndy.state.tokenMint);\r\n            const token = (\r\n              await getAtaForMint(mint, anchorWallet.publicKey)\r\n            )[0];\r\n            try {\r\n              const balance = await connection.getTokenAccountBalance(token);\r\n\r\n              const valid = new anchor.BN(balance.value.amount).gte(userPrice);\r\n\r\n              // only allow user to mint if token balance >  the user if the balance > 0\r\n              setIsValidBalance(valid);\r\n              active = active && valid;\r\n            } catch (e) {\r\n              setIsValidBalance(false);\r\n              active = false;\r\n              // no whitelist user, no mint\r\n              console.log('There was a problem fetching SPL token balance');\r\n              console.log(e);\r\n            }\r\n          } else {\r\n            const balance = new anchor.BN(\r\n              await connection.getBalance(anchorWallet.publicKey),\r\n            );\r\n            const valid = balance.gte(userPrice);\r\n            setIsValidBalance(valid);\r\n            active = active && valid;\r\n          }\r\n\r\n          // datetime to stop the mint?\r\n          if (cndy?.state.endSettings?.endSettingType.date) {\r\n            setEndDate(toDate(cndy.state.endSettings.number));\r\n            if (\r\n              cndy.state.endSettings.number.toNumber() <\r\n              new Date().getTime() / 1000\r\n            ) {\r\n              active = false;\r\n            }\r\n          }\r\n          // amount to stop the mint?\r\n          if (cndy?.state.endSettings?.endSettingType.amount) {\r\n            let limit = Math.min(\r\n              cndy.state.endSettings.number.toNumber(),\r\n              cndy.state.itemsAvailable,\r\n            );\r\n            if (cndy.state.itemsRedeemed < limit) {\r\n              setItemsRemaining(limit - cndy.state.itemsRedeemed);\r\n            } else {\r\n              setItemsRemaining(0);\r\n              cndy.state.isSoldOut = true;\r\n            }\r\n          } else {\r\n            setItemsRemaining(cndy.state.itemsRemaining);\r\n          }\r\n\r\n          if (cndy.state.isSoldOut) {\r\n            active = false;\r\n          }\r\n\r\n          const [collectionPDA] = await getCollectionPDA(props.candyMachineId);\r\n          const collectionPDAAccount = await connection.getAccountInfo(\r\n            collectionPDA,\r\n          );\r\n\r\n          setIsActive((cndy.state.isActive = active));\r\n          setIsPresale((cndy.state.isPresale = presale));\r\n          setCandyMachine(cndy);\r\n\r\n          const txnEstimate =\r\n            892 +\r\n            (!!collectionPDAAccount && cndy.state.retainAuthority ? 182 : 0) +\r\n            (cndy.state.tokenMint ? 177 : 0) +\r\n            (cndy.state.whitelistMintSettings ? 33 : 0) +\r\n            (cndy.state.whitelistMintSettings?.mode?.burnEveryTime ? 145 : 0) +\r\n            (cndy.state.gatekeeper ? 33 : 0) +\r\n            (cndy.state.gatekeeper?.expireOnUse ? 66 : 0);\r\n\r\n          setNeedTxnSplit(txnEstimate > 1230);\r\n        } catch (e) {\r\n          if (e instanceof Error) {\r\n            if (\r\n              e.message === `Account does not exist ${props.candyMachineId}`\r\n            ) {\r\n              setAlertState({\r\n                open: true,\r\n                message: `Couldn't fetch candy machine state from candy machine with address: ${props.candyMachineId}, using rpc: ${props.rpcHost}! You probably typed the REACT_APP_CANDY_MACHINE_ID value in wrong in your .env file, or you are using the wrong RPC!`,\r\n                severity: 'error',\r\n                hideDuration: null,\r\n              });\r\n            } else if (\r\n              e.message.startsWith('failed to get info about account')\r\n            ) {\r\n              setAlertState({\r\n                open: true,\r\n                message: `Couldn't fetch candy machine state with rpc: ${props.rpcHost}! This probably means you have an issue with the REACT_APP_SOLANA_RPC_HOST value in your .env file, or you are not using a custom RPC!`,\r\n                severity: 'error',\r\n                hideDuration: null,\r\n              });\r\n            }\r\n          } else {\r\n            setAlertState({\r\n              open: true,\r\n              message: `${e}`,\r\n              severity: 'error',\r\n              hideDuration: null,\r\n            });\r\n          }\r\n          console.log(e);\r\n        }\r\n      } else {\r\n        setAlertState({\r\n          open: true,\r\n          message: `Your REACT_APP_CANDY_MACHINE_ID value in the .env file doesn't look right! Make sure you enter it in as plain base-58 address!`,\r\n          severity: 'error',\r\n          hideDuration: null,\r\n        });\r\n      }\r\n    },\r\n    [anchorWallet, props.candyMachineId, props.rpcHost],\r\n  );\r\n\r\n  const onMint = async (\r\n    beforeTransactions: Transaction[] = [],\r\n    afterTransactions: Transaction[] = [],\r\n  ) => {\r\n    try {\r\n      setIsUserMinting(true);\r\n      document.getElementById('#identity')?.click();\r\n      if (wallet.connected && candyMachine?.program && wallet.publicKey) {\r\n        let setupMint: SetupState | undefined;\r\n        if (needTxnSplit && setupTxn === undefined) {\r\n          setAlertState({\r\n            open: true,\r\n            message: 'Please sign account setup transaction',\r\n            severity: 'info',\r\n          });\r\n          setupMint = await createAccountsForMint(\r\n            candyMachine,\r\n            wallet.publicKey,\r\n          );\r\n          let status: any = { err: true };\r\n          if (setupMint.transaction) {\r\n            status = await awaitTransactionSignatureConfirmation(\r\n              setupMint.transaction,\r\n              props.txTimeout,\r\n              props.connection,\r\n              true,\r\n            );\r\n          }\r\n          if (status && !status.err) {\r\n            setSetupTxn(setupMint);\r\n            setAlertState({\r\n              open: true,\r\n              message:\r\n                'Setup transaction succeeded! Please sign minting transaction',\r\n              severity: 'info',\r\n            });\r\n          } else {\r\n            setAlertState({\r\n              open: true,\r\n              message: 'Mint failed! Please try again!',\r\n              severity: 'error',\r\n            });\r\n            setIsUserMinting(false);\r\n            return;\r\n          }\r\n        } else {\r\n          setAlertState({\r\n            open: true,\r\n            message: 'Please sign minting transaction',\r\n            severity: 'info',\r\n          });\r\n        }\r\n\r\n        let mintResult = await mintOneToken(\r\n          candyMachine,\r\n          wallet.publicKey,\r\n          beforeTransactions,\r\n          afterTransactions,\r\n          setupMint ?? setupTxn,\r\n        );\r\n\r\n        let status: any = { err: true };\r\n        let metadataStatus = null;\r\n        if (mintResult) {\r\n          status = await awaitTransactionSignatureConfirmation(\r\n            mintResult.mintTxId,\r\n            props.txTimeout,\r\n            props.connection,\r\n            true,\r\n          );\r\n\r\n          metadataStatus =\r\n            await candyMachine.program.provider.connection.getAccountInfo(\r\n              mintResult.metadataKey,\r\n              'processed',\r\n            );\r\n          console.log('Metadata status: ', !!metadataStatus);\r\n        }\r\n\r\n        if (status && !status.err && metadataStatus) {\r\n          // manual update since the refresh might not detect\r\n          // the change immediately\r\n          let remaining = itemsRemaining! - 1;\r\n          setItemsRemaining(remaining);\r\n          setIsActive((candyMachine.state.isActive = remaining > 0));\r\n          candyMachine.state.isSoldOut = remaining === 0;\r\n          setSetupTxn(undefined);\r\n          setAlertState({\r\n            open: true,\r\n            message: 'Congratulations! Mint succeeded!',\r\n            severity: 'success',\r\n            hideDuration: 7000,\r\n          });\r\n          refreshCandyMachineState('processed');\r\n        } else if (status && !status.err) {\r\n          setAlertState({\r\n            open: true,\r\n            message:\r\n              'Mint likely failed! Anti-bot SOL 0.01 fee potentially charged! Check the explorer to confirm the mint failed and if so, make sure you are eligible to mint before trying again.',\r\n            severity: 'error',\r\n            hideDuration: 8000,\r\n          });\r\n          refreshCandyMachineState();\r\n        } else {\r\n          setAlertState({\r\n            open: true,\r\n            message: 'Mint failed! Please try again!',\r\n            severity: 'error',\r\n          });\r\n          refreshCandyMachineState();\r\n        }\r\n      }\r\n    } catch (error: any) {\r\n      let message = error.msg || 'Minting failed! Please try again!';\r\n      if (!error.msg) {\r\n        if (!error.message) {\r\n          message = 'Transaction timeout! Please try again.';\r\n        } else if (error.message.indexOf('0x137')) {\r\n          console.log(error);\r\n          message = `SOLD OUT!`;\r\n        } else if (error.message.indexOf('0x135')) {\r\n          message = `Insufficient funds to mint. Please fund your wallet.`;\r\n        }\r\n      } else {\r\n        if (error.code === 311) {\r\n          console.log(error);\r\n          message = `SOLD OUT!`;\r\n          window.location.reload();\r\n        } else if (error.code === 312) {\r\n          message = `Minting period hasn't started yet.`;\r\n        }\r\n      }\r\n\r\n      setAlertState({\r\n        open: true,\r\n        message,\r\n        severity: 'error',\r\n      });\r\n      // updates the candy machine state to reflect the latest\r\n      // information on chain\r\n      refreshCandyMachineState();\r\n    } finally {\r\n      setIsUserMinting(false);\r\n    }\r\n  };\r\n\r\n  const toggleMintButton = () => {\r\n    let active = !isActive || isPresale;\r\n\r\n    if (active) {\r\n      if (candyMachine!.state.isWhitelistOnly && !isWhitelistUser) {\r\n        active = false;\r\n      }\r\n      if (endDate && Date.now() >= endDate.getTime()) {\r\n        active = false;\r\n      }\r\n    }\r\n\r\n    if (\r\n      isPresale &&\r\n      candyMachine!.state.goLiveDate &&\r\n      candyMachine!.state.goLiveDate.toNumber() <= new Date().getTime() / 1000\r\n    ) {\r\n      setIsPresale((candyMachine!.state.isPresale = false));\r\n    }\r\n\r\n    setIsActive((candyMachine!.state.isActive = active));\r\n  };\r\n\r\n  useEffect(() => {\r\n    refreshCandyMachineState();\r\n  }, [\r\n    anchorWallet,\r\n    props.candyMachineId,\r\n    props.connection,\r\n    refreshCandyMachineState,\r\n  ]);\r\n\r\n  useEffect(() => {\r\n    (function loop() {\r\n      setTimeout(() => {\r\n        refreshCandyMachineState();\r\n        loop();\r\n      }, 20000);\r\n    })();\r\n  }, [refreshCandyMachineState]);\r\n\r\n  return (\r\n    <Container style={{ marginTop: 100 }}>\r\n      <Container maxWidth=\"xs\" style={{ position: 'relative' }}>\r\n        <Paper\r\n          style={{\r\n            padding: 24,\r\n            paddingBottom: 10,\r\n            backgroundColor: '#151A1F',\r\n            borderRadius: 6,\r\n          }}\r\n        >\r\n          {!wallet.connected ? (\r\n            <ConnectButton>Connect Wallet</ConnectButton>\r\n          ) : (\r\n            <>\r\n              {candyMachine && (\r\n                <Grid\r\n                  container\r\n                  direction=\"row\"\r\n                  justifyContent=\"center\"\r\n                  wrap=\"nowrap\"\r\n                >\r\n                  <Grid item xs={3}>\r\n                    <Typography variant=\"body2\" color=\"textSecondary\">\r\n                      Remaining\r\n                    </Typography>\r\n                    <Typography\r\n                      variant=\"h6\"\r\n                      color=\"textPrimary\"\r\n                      style={{\r\n                        fontWeight: 'bold',\r\n                      }}\r\n                    >\r\n                      {`${itemsRemaining}`}\r\n                    </Typography>\r\n                  </Grid>\r\n                  <Grid item xs={4}>\r\n                    <Typography variant=\"body2\" color=\"textSecondary\">\r\n                      {isWhitelistUser && discountPrice\r\n                        ? 'Discount Price'\r\n                        : 'Price'}\r\n                    </Typography>\r\n                    <Typography\r\n                      variant=\"h6\"\r\n                      color=\"textPrimary\"\r\n                      style={{ fontWeight: 'bold' }}\r\n                    >\r\n                      {isWhitelistUser && discountPrice\r\n                        ? `◎ ${formatNumber.asNumber(discountPrice)}`\r\n                        : `◎ ${formatNumber.asNumber(\r\n                            candyMachine.state.price,\r\n                          )}`}\r\n                    </Typography>\r\n                  </Grid>\r\n                  <Grid item xs={5}>\r\n                    {isActive && endDate && Date.now() < endDate.getTime() ? (\r\n                      <>\r\n                        <MintCountdown\r\n                          key=\"endSettings\"\r\n                          date={getCountdownDate(candyMachine)}\r\n                          style={{ justifyContent: 'flex-end' }}\r\n                          status=\"COMPLETED\"\r\n                          onComplete={toggleMintButton}\r\n                        />\r\n                        <Typography\r\n                          variant=\"caption\"\r\n                          align=\"center\"\r\n                          display=\"block\"\r\n                          style={{ fontWeight: 'bold' }}\r\n                        >\r\n                          TO END OF MINT\r\n                        </Typography>\r\n                      </>\r\n                    ) : (\r\n                      <>\r\n                        <MintCountdown\r\n                          key=\"goLive\"\r\n                          date={getCountdownDate(candyMachine)}\r\n                          style={{ justifyContent: 'flex-end' }}\r\n                          status={\r\n                            candyMachine?.state?.isSoldOut ||\r\n                            (endDate && Date.now() > endDate.getTime())\r\n                              ? 'COMPLETED'\r\n                              : isPresale\r\n                              ? 'PRESALE'\r\n                              : 'LIVE'\r\n                          }\r\n                          onComplete={toggleMintButton}\r\n                        />\r\n                        {isPresale &&\r\n                          candyMachine.state.goLiveDate &&\r\n                          candyMachine.state.goLiveDate.toNumber() >\r\n                            new Date().getTime() / 1000 && (\r\n                            <Typography\r\n                              variant=\"caption\"\r\n                              align=\"center\"\r\n                              display=\"block\"\r\n                              style={{ fontWeight: 'bold' }}\r\n                            >\r\n                              UNTIL PUBLIC MINT\r\n                            </Typography>\r\n                          )}\r\n                      </>\r\n                    )}\r\n                  </Grid>\r\n                </Grid>\r\n              )}\r\n              <MintContainer>\r\n                {candyMachine?.state.isActive &&\r\n                candyMachine?.state.gatekeeper &&\r\n                wallet.publicKey &&\r\n                wallet.signTransaction ? (\r\n                  <GatewayProvider\r\n                    wallet={{\r\n                      publicKey:\r\n                        wallet.publicKey ||\r\n                        new PublicKey(CANDY_MACHINE_PROGRAM),\r\n                      //@ts-ignore\r\n                      signTransaction: wallet.signTransaction,\r\n                    }}\r\n                    gatekeeperNetwork={\r\n                      candyMachine?.state?.gatekeeper?.gatekeeperNetwork\r\n                    }\r\n                    clusterUrl={\r\n                      props.network === WalletAdapterNetwork.Devnet\r\n                        ? 'https://api.devnet.solana.com'\r\n                        : rpcUrl\r\n                    }\r\n                    handleTransaction={async (transaction: Transaction) => {\r\n                      setIsUserMinting(true);\r\n                      const userMustSign = transaction.signatures.find(sig =>\r\n                        sig.publicKey.equals(wallet.publicKey!),\r\n                      );\r\n                      if (userMustSign) {\r\n                        setAlertState({\r\n                          open: true,\r\n                          message: 'Please sign one-time Civic Pass issuance',\r\n                          severity: 'info',\r\n                        });\r\n                        try {\r\n                          transaction = await wallet.signTransaction!(\r\n                            transaction,\r\n                          );\r\n                        } catch (e) {\r\n                          setAlertState({\r\n                            open: true,\r\n                            message: 'User cancelled signing',\r\n                            severity: 'error',\r\n                          });\r\n                          // setTimeout(() => window.location.reload(), 2000);\r\n                          setIsUserMinting(false);\r\n                          throw e;\r\n                        }\r\n                      } else {\r\n                        setAlertState({\r\n                          open: true,\r\n                          message: 'Refreshing Civic Pass',\r\n                          severity: 'info',\r\n                        });\r\n                      }\r\n                      try {\r\n                        await sendTransaction(\r\n                          props.connection,\r\n                          wallet,\r\n                          transaction,\r\n                          [],\r\n                          true,\r\n                          'confirmed',\r\n                        );\r\n                        setAlertState({\r\n                          open: true,\r\n                          message: 'Please sign minting',\r\n                          severity: 'info',\r\n                        });\r\n                      } catch (e) {\r\n                        setAlertState({\r\n                          open: true,\r\n                          message:\r\n                            'Solana dropped the transaction, please try again',\r\n                          severity: 'warning',\r\n                        });\r\n                        console.error(e);\r\n                        // setTimeout(() => window.location.reload(), 2000);\r\n                        setIsUserMinting(false);\r\n                        throw e;\r\n                      }\r\n                      await onMint();\r\n                    }}\r\n                    broadcastTransaction={false}\r\n                    options={{ autoShowModal: false }}\r\n                  >\r\n                    <MintButton\r\n                      candyMachine={candyMachine}\r\n                      isMinting={isUserMinting}\r\n                      setIsMinting={val => setIsUserMinting(val)}\r\n                      onMint={onMint}\r\n                      isActive={\r\n                        isActive ||\r\n                        (isPresale && isWhitelistUser && isValidBalance)\r\n                      }\r\n                    />\r\n                  </GatewayProvider>\r\n                ) : (\r\n                  <MintButton\r\n                    candyMachine={candyMachine}\r\n                    isMinting={isUserMinting}\r\n                    setIsMinting={val => setIsUserMinting(val)}\r\n                    onMint={onMint}\r\n                    isActive={\r\n                      isActive ||\r\n                      (isPresale && isWhitelistUser && isValidBalance)\r\n                    }\r\n                  />\r\n                )}\r\n              </MintContainer>\r\n            </>\r\n          )}\r\n          <Typography\r\n            variant=\"caption\"\r\n            align=\"center\"\r\n            display=\"block\"\r\n            style={{ marginTop: 7, color: 'grey' }}\r\n          >\r\n            Powered by METAPLEX\r\n          </Typography>\r\n        </Paper>\r\n      </Container>\r\n\r\n      <Snackbar\r\n        open={alertState.open}\r\n        autoHideDuration={\r\n          alertState.hideDuration === undefined ? 6000 : alertState.hideDuration\r\n        }\r\n        onClose={() => setAlertState({ ...alertState, open: false })}\r\n      >\r\n        <Alert\r\n          onClose={() => setAlertState({ ...alertState, open: false })}\r\n          severity={alertState.severity}\r\n        >\r\n          {alertState.message}\r\n        </Alert>\r\n      </Snackbar>\r\n    </Container>\r\n  );\r\n};\r\n\r\nconst getCountdownDate = (\r\n  candyMachine: CandyMachineAccount,\r\n): Date | undefined => {\r\n  if (\r\n    candyMachine.state.isActive &&\r\n    candyMachine.state.endSettings?.endSettingType.date\r\n  ) {\r\n    return toDate(candyMachine.state.endSettings.number);\r\n  }\r\n\r\n  return toDate(\r\n    candyMachine.state.goLiveDate\r\n      ? candyMachine.state.goLiveDate\r\n      : candyMachine.state.isPresale\r\n      ? new anchor.BN(new Date().getTime() / 1000)\r\n      : undefined,\r\n  );\r\n};\r\n\r\nexport default Home;\r\n"]},"metadata":{},"sourceType":"module"}